<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <!-- ⑥ レスポンシブデザインのための設定 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- ④ 適切なタイトル（<title>タグ）を設定 -->
    <title>Webサイト高速化 体験シミュレーター</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- ⑤ CSSは別ファイル（main.css）を参照 -->
    <link rel="stylesheet" href="main.css">
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Header / Problem Statement -->
    <header class="bg-white">
        <div class="max-w-5xl mx-auto px-6 py-12 text-center">
            <h1 class="text-3xl md:text-5xl font-black text-gray-900 leading-tight">
                なぜ、阿部寛さんのホームページは<br class="md:hidden"><span class="gradient-text">"爆速"</span>なのか！？
            </h1>
            <p class="mt-6 max-w-3xl mx-auto text-base md:text-lg text-gray-600">
                阿部寛さんのホームページは知っていますか？爆速で開き、ラグても見ることができます。
                最近のウェブサイトは多機能ですが、表示が遅くなりがちです。しかし、<a href="http://abehiroshi.la.coocan.jp/" target="_blank" class="text-indigo-600 hover:underline">阿部寛さん</a>や<a href="https://kattu0403.com/" target="_blank" class="text-indigo-600 hover:underline">かっつーさん</a>のサイトのように、速いをページもあります。
            </p>
            <p class="mt-4 max-w-3xl mx-auto text-base md:text-lg text-gray-600">
                このシミュレーターで、サイトが"重く"なる原因を探してみましょう。
            </p>
        </div>
    </header>

    <!-- Simulator Section -->
    <div class="max-w-7xl mx-auto my-8 p-4">
        <div class="flex flex-col lg:flex-row w-full min-h-[70vh] bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-200">
            <!-- Control Panel -->
            <aside class="w-full lg:w-1/3 xl:w-1/4 bg-white p-6 border-r border-gray-200 flex flex-col">
                <div class="flex-grow overflow-y-auto control-panel">
                    <h2 class="text-2xl font-bold mb-1 text-gray-900">高速化シミュレーター</h2>
                    <p class="text-sm text-gray-600 mb-6">サイトが"重く"なる過程を体験してみよう。</p>

                    <div class="space-y-5">
                        <!-- Base Page -->
                        <div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="base-html" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" checked disabled>
                                <span class="font-semibold text-gray-800">基本のHTMLページ</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-8 mt-1">ページの骨格となる最小限のテキスト。これが全ての基礎です。</p>
                        </div>

                        <!-- Add Image -->
                        <div>
                            <span class="font-semibold text-gray-800">① 画像を追加</span>
                            <fieldset class="mt-2 ml-3 space-y-2">
                                <label class="flex items-center space-x-3 cursor-pointer">
                                    <input type="radio" name="image-choice" id="no-image" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300" checked>
                                    <span class="text-sm">画像なし</span>
                                </label>
                                <label class="flex items-center space-x-3 cursor-pointer">
                                    <input type="radio" name="image-choice" id="light-image" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                    <span class="text-sm">軽い画像 (286KB)</span>
                                </label>
                                <label class="flex items-center space-x-3 cursor-pointer">
                                    <input type="radio" name="image-choice" id="heavy-image" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300">
                                    <span class="text-sm">重い画像 (756MB)</span>
                                </label>
                            </fieldset>
                            <p class="text-xs text-gray-500 ml-3 mt-2">画像のデータ量がパフォーマンスに与える影響を体験できます。画像は<a href="https://www.photo-ac.com/" target="_blank" class="text-indigo-600 hover:underline">photoAC</a>より</p>
                        </div>

                        <!-- Add CSS -->
                        <div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="add-css" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="font-semibold text-gray-800">② CSSで装飾</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-8 mt-1">サイトのデザインを指定します。複雑な装飾はブラウザの描画処理に負荷をかけます。</p>
                        </div>

                        <!-- Add Simple JS -->
                        <div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="add-simple-js" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="font-semibold text-gray-800">③ 簡単なJavaScriptを追加</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-8 mt-1">カーソル追従エフェクト。少しのJSでも、常に処理が走るため負荷がかかります。</p>
                        </div>

                        <!-- Add External JS -->
                        <div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="add-external-js" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="font-semibold text-gray-800">④ 外部のJavaScriptを追加</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-8 mt-1">SNSシェアボタンなど。外部サーバーとの通信が発生し、待ち時間が増えます。</p>
                        </div>

                        <!-- Add Heavy JS Library -->
                        <div>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="add-heavy-js" class="h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                <span class="font-semibold text-gray-800">⑤ 重いJSライブラリを追加</span>
                            </label>
                            <p class="text-xs text-gray-500 ml-8 mt-1">画像スライダー。高機能な反面、ファイルサイズが大きく、処理も複雑で最も影響が大きいです。</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 pt-6 border-t border-gray-200">
                     <button id="reset-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                        リセットして速さを取り戻す
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="flex-grow flex flex-col bg-gray-100">
                <!-- Performance Metrics -->
                <div class="bg-white p-4 shadow-md z-10 border-b border-gray-200">
                    <h3 class="text-lg font-bold mb-2 text-center">パフォーマンス計測結果</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="text-sm text-blue-800 font-medium">ページ表示時間</p>
                            <p id="load-time" class="text-2xl font-bold text-blue-900">... ms</p>
                        </div>
                        <div class="bg-green-50 p-3 rounded-lg">
                            <p class="text-sm text-green-800 font-medium">データ総量 (推定)</p>
                            <p id="data-size" class="text-2xl font-bold text-green-900">... KB</p>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg col-span-2 md:col-span-1">
                            <p class="text-sm text-purple-800 font-medium">リクエスト数 (推定)</p>
                            <p id="request-count" class="text-2xl font-bold text-purple-900">...</p>
                        </div>
                    </div>
                </div>

                <!-- Website Preview -->
                <div class="flex-grow p-4 relative">
                    <div id="loader" class="absolute inset-0 flex items-center justify-center bg-gray-100/80 z-20">
                        <div class="text-center">
                            <svg class="animate-spin h-8 w-8 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <p class="mt-2 text-gray-600">ページを生成中...</p>
                        </div>
                    </div>
                    <iframe id="preview-frame" class="w-full h-full border-2 border-gray-300 rounded-lg bg-white invisible"></iframe>
                </div>
            </main>
        </div>
    </div>

    <!-- Technical Explanation Section -->
    <section class="bg-white mt-16">
        <div class="max-w-4xl mx-auto px-6 py-16">
            <h2 class="text-3xl font-bold text-center mb-4">体験の技術解説</h2>
            <p class="text-center text-gray-600 mb-12">シミュレーターで体験した「重さ」の正体を、コードと一緒に見ていきましょう。</p>

            <!-- 1. 画像 -->
            <div class="mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-indigo-500 pl-4">① 画像のデータ量</h3>
                <p class="text-gray-600 mb-4">
                    最も分かりやすい速度低下の原因は、データ量です。特に画像はウェブページのデータ量の大半を占めることがあります。「重い画像」は単純にファイルサイズが大きいため、ダウンロードに時間がかかります。
                </p>
                <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                    <pre><code class="language-html">&lt;!-- 軽い画像 (100KB) --&gt;
&lt;img src="flower"&gt;

&lt;!-- 重い画像 (1MB = 1024KB) --&gt;
&lt;img src="https://placehold.co/1200x800/.../Heavy+Image+(756MB)"&gt;</code></pre>
                </div>
                <p class="mt-4 p-3 bg-indigo-50 text-indigo-800 rounded-md text-sm">
                    <strong>ポイント：</strong>Webサイトに画像を載せる際は、見た目が劣化しない範囲で、できるだけファイルサイズを小さく「圧縮」することが非常に重要です。
                </p>
            </div>

            <!-- 2. CSS -->
            <div class="mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-indigo-500 pl-4">② CSSによる描画負荷</h3>
                <p class="text-gray-600 mb-4">
                    CSSはサイトの見た目を整えますが、複雑な装飾やアニメーションは、ブラウザに「描画」という計算処理をさせます。これも積み重なるとパフォーマンスに影響します。
                </p>
                <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                    <pre><code class="language-css">/* シミュレーターで追加したアニメーション */
h1 {
    animation: fadeInDown 1s ease-out;
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}</code></pre>
                </div>
                 <p class="mt-4 p-3 bg-indigo-50 text-indigo-800 rounded-md text-sm">
                    <strong>ポイント：</strong>便利なアニメーションも、多用するとブラウザの仕事を増やしてしまいます。効果的な場所で控えめに使うのがコツです。
                </p>
            </div>

            <!-- 3. 簡単なJavaScript -->
            <div class="mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-indigo-500 pl-4">③ JavaScriptによる処理負荷</h3>
                <p class="text-gray-600 mb-4">
                    JavaScriptはページに「動き」を与えます。シミュレーターのカーソル追従エフェクトは、マウスが動くたびに常にプログラムが実行されています。このような小さな処理でも、常時実行されるとCPUに負荷をかけ続けます。
                </p>
                <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                    <pre><code class="language-javascript">// マウスが動く"たびに"実行される処理
window.addEventListener('mousemove', e => {
    // パーティクルの座標を更新する
    particle.style.transform = `translate(${e.clientX}px, ${e.clientY}px)`;
});</code></pre>
                </div>
                 <p class="mt-4 p-3 bg-indigo-50 text-indigo-800 rounded-md text-sm">
                    <strong>ポイント：</strong>ユーザーの操作に反応するインタラクティブな機能は便利ですが、その裏では常にプログラムが待機・実行されていることを意識する必要があります。
                </p>
            </div>

            <!-- 4. 外部JavaScript -->
            <div class="mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-indigo-500 pl-4">④ 外部ファイルによる通信</h3>
                <p class="text-gray-600 mb-4">
                    ウェブページは、自分のサーバーだけでなく、他のサーバーにあるファイル（外部ファイル）を読み込むことがあります。SNSボタンやWebフォント、広告などがこれにあたります。ファイルを読みに行くたびに「通信」が発生し、その待ち時間が表示速度に影響します。
                </p>
                <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                    <pre><code class="language-html">&lt;!-- 外部のサーバー(cdnjs.cloudflare.com)からCSSファイルを読み込んでいる --&gt;
&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"&gt;</code></pre>
                </div>
                 <p class="mt-4 p-3 bg-indigo-50 text-indigo-800 rounded-md text-sm">
                    <strong>ポイント：</strong>外部サービスの利用は手軽で便利ですが、リクエスト数を増やし、相手のサーバーの応答速度にも依存するため、パフォーマンス低下の要因になりやすいです。
                </p>
            </div>
            
            <!-- 5. 重いJSライブラリ -->
            <div class="mb-12">
                <h3 class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-indigo-500 pl-4">⑤ 重いJavaScriptライブラリ</h3>
                <!-- ③ 番号なし箇条書き（<ul>タグ） -->
                <p class="text-gray-600 mb-4">
                    現代のサイトが遅くなる最大の原因がこれです。画像スライダーなどを簡単に実装できる「ライブラリ」は、多くの機能が詰め込まれているため、これまでの要因をすべて含んでいます。
                </p>
                <ul class="list-disc list-inside text-gray-600 space-y-2 mb-4">
                    <li><strong class="text-red-600">巨大なファイルサイズ：</strong>ライブラリ自体のファイルが大きい。</li>
                    <li><strong class="text-red-600">複雑な処理：</strong>高機能な分、ブラウザが行う計算処理も複雑で重い。</li>
                    <li><strong class="text-red-600">追加の通信：</strong>ライブラリがさらに別のファイルを読み込むこともある。</li>
                </ul>
                <div class="bg-gray-800 text-white p-4 rounded-lg text-sm overflow-x-auto">
                    <pre><code class="language-html">&lt;!-- ライブラリ本体の読み込み（通信が発生し、ファイルサイズも大きい） --&gt;
&lt;script src="https://unpkg.com/swiper/swiper-bundle.min.js"&gt;&lt;/script&gt;

&lt;script&gt;
    // ライブラリを動作させるための命令（ブラウザがこれを解釈・実行する）
    new Swiper('.swiper', {
        loop: true,
        // ...その他のたくさんの設定
    });
&lt;/script&gt;</code></pre>
                </div>
                 <p class="mt-4 p-3 bg-indigo-50 text-indigo-800 rounded-md text-sm">
                    <strong>ポイント：</strong>ライブラリは開発を効率化しますが、本当にその全ての機能が必要か検討することが重要です。「少しの機能のために、巨大なライブラリを導入する」のは、パフォーマンスを悪化させる典型的なパターンです。
                </p>
            </div>

        </div>
    </section>

    <footer class="text-center py-8 bg-gray-100">
        <p class="text-gray-500">Webサイト高速化 体験シミュレーター</p>
        <div class="mt-2 text-sm">
            <a href="http://abehiroshi.la.coocan.jp/" target="_blank" class="text-indigo-600 hover:underline">参考: 阿部寛のホームページ</a> | 
            <a href="https://kattu0403.com/" target="_blank" class="text-indigo-600 hover:underline">参考: かっつーのホームページ</a>
        </div>
        <p class="text-xs text-gray-400 mt-4">本コンテンツの作成時間（HTML/CSS/JavaScriptの設計・実装を含む）：約７時間</p>
    </footer>


    <script>
        // DOM要素の取得
        const controls = {
            image: {
                none: document.getElementById('no-image'),
                light: document.getElementById('light-image'),
                heavy: document.getElementById('heavy-image'),
            },
            css: document.getElementById('add-css'),
            simpleJs: document.getElementById('add-simple-js'),
            externalJs: document.getElementById('add-external-js'),
            heavyJs: document.getElementById('add-heavy-js'),
        };
        const loadTimeEl = document.getElementById('load-time');
        const dataSizeEl = document.getElementById('data-size');
        const requestCountEl = document.getElementById('request-count');
        const previewFrame = document.getElementById('preview-frame');
        const loader = document.getElementById('loader');
        const resetButton = document.getElementById('reset-button');

        let startTime = 0;

        // 各要素のパフォーマンスコストを定義
        const costs = {
            base: { size: 3, requests: 1 },
            lightImage: { size: 50, requests: 1 },
            heavyImage: { size: 1024, requests: 1 },
            css: { size: 15, requests: 1 },
            simpleJs: { size: 2, requests: 0 },
            externalJs: { size: 80, requests: 2 },
            heavyJs: { size: 90, requests: 1 },
        };

        // シミュレーションを更新するメイン関数
        const updateSimulation = () => {
            loader.style.display = 'flex';
            previewFrame.style.visibility = 'hidden';
            
            startTime = performance.now();

            const { html, totalSize, requestCount } = generateHtmlContent();
            
            previewFrame.srcdoc = html;

            dataSizeEl.textContent = `${totalSize.toFixed(1)} KB`;
            requestCountEl.textContent = `${requestCount}`;
            loadTimeEl.textContent = '計測中...';
        };
        
        // iframeの読み込みが完了したときの処理
        previewFrame.onload = () => {
            const endTime = performance.now();
            const timeTaken = endTime - startTime;
            loadTimeEl.textContent = `${timeTaken.toFixed(0)} ms`;
            
            loader.style.display = 'none';
            previewFrame.style.visibility = 'visible';
        };

        // HTMLコンテンツとパフォーマンス値を生成する関数
        const generateHtmlContent = () => {
            let totalSize = costs.base.size;
            let requestCount = costs.base.requests;
            
            const today = new Date();
            const dateString = `${today.getFullYear()}年${today.getMonth() + 1}月${today.getDate()}日`;
            
            let styles =
                '<style>' +
                "body { font-family: 'MS PGothic', sans-serif; background-color: #FFFFCC; color: #333; padding: 1rem; }" +
                "h1 { font-size: 1.5rem; border-bottom: 2px solid #000; }" +
                ".content { margin-top: 1rem; }" +
                '</style>';

            let headScripts = '';
            let bodyContent =
                '<h1>阿部寛のホームページ（風）</h1>' +
                '<div class="content">' +
                '    <p>このサイトは爆速です。</p>' +
                `    <p>更新日: ${dateString}</p>` +
                '</div>';

            let bodyScripts = '';

            // ① 画像の追加
            if (controls.image.light.checked) {
                totalSize += costs.lightImage.size;
                requestCount += costs.lightImage.requests;
                bodyContent +=
                    '<h2 style="margin-top: 2rem; border-bottom: 1px solid #ccc;">追加された画像</h2>' +
                    '<img src="png/keybord.jpg" alt="軽い画像" style="width: 100%; max-width: 400px; margin-top: 1rem;">';
            } else if (controls.image.heavy.checked) {
                totalSize += costs.heavyImage.size;
                requestCount += costs.heavyImage.requests;
                bodyContent +=
                    '<h2 style="margin-top: 2rem; border-bottom: 1px solid #ccc;">追加された画像</h2>' +
                    '<img src="png/fuzi.jpg" alt="重い画像" style="width: 100%; max-width: 400px; margin-top: 1rem;">';
            } else if (controls.image.none.checked) {
                bodyContent +=
                    '<h2 style="margin-top: 2rem; border-bottom: 1px solid #ccc;">追加された画像</h2>' +
                    '<p>画像は追加されていません。</p>';
            }

            // ② CSSの追加
            if (controls.css.checked) {
                totalSize += costs.css.size;
                requestCount += costs.css.requests;
                styles +=
                    '<style>' +
                    "body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); font-family: 'Helvetica', sans-serif; }" +
                    "h1 { color: #2c3e50; text-shadow: 1px 1px 2px rgba(0,0,0,0.1); animation: fadeInDown 1s ease-out; }" +
                    "@keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }" +
                    '</style>';
            }

            // ③ 簡単なJSの追加
            if (controls.simpleJs.checked) {
                totalSize += costs.simpleJs.size;
                requestCount += costs.simpleJs.requests;
                bodyScripts +=
                    '<script>' +
                    "const particle = document.createElement('div');" +
                    "particle.style.position = 'fixed'; particle.style.top = '0'; particle.style.left = '0';" +
                    "particle.style.width = '10px'; particle.style.height = '10px'; particle.style.borderRadius = '50%';" +
                    "particle.style.backgroundColor = 'rgba(255,0,0,0.5)'; particle.style.pointerEvents = 'none';" +
                    "particle.style.zIndex = '9999'; particle.style.transition = 'transform 0.1s ease-out';" +
                    "document.body.appendChild(particle);" +
                    "window.addEventListener('mousemove', e => { particle.style.transform = 'translate(' + e.clientX + 'px, ' + e.clientY + 'px)'; });" +
                    '<\/script>';
            }
            
            // ④ 外部JSの追加
            if (controls.externalJs.checked) {
                totalSize += costs.externalJs.size;
                requestCount += costs.externalJs.requests;
                headScripts += '<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">';
                bodyContent +=
                    '<div style="margin-top: 2rem;">' +
                    '    <h2 style="border-bottom: 1px solid #ccc;">外部サービス連携</h2>' +
                    '    <p>SNSシェアボタン (FontAwesome使用)</p>' +
                    '    <i class="fab fa-twitter fa-2x" style="color: #1DA1F2; margin-right: 10px;"></i>' +
                    '    <i class="fab fa-facebook fa-2x" style="color: #1877F2;"></i>' +
                    '</div>';
            }
            
            // ⑤ 重いJSライブラリの追加
            if (controls.heavyJs.checked) {
                totalSize += costs.heavyJs.size;
                requestCount += costs.heavyJs.requests;
                headScripts += '<link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />';
                bodyScripts += '<script src="https://unpkg.com/swiper/swiper-bundle.min.js"><\/script>';
                bodyContent +=
                    '<div style="margin-top: 2rem;">' +
                    '    <h2 style="border-bottom: 1px solid #ccc;">画像スライダー (JSライブラリ)</h2>' +
                    '    <div class="swiper" style="width: 100%; max-width: 400px; height: 250px; margin-top: 1rem; background: #eee;">' +
                    '        <div class="swiper-wrapper">' +
                    '            <div class="swiper-slide" style="display:flex; align-items:center; justify-content:center; background-color:#7E57C2; color:white;">Slide 1</div>' +
                    '            <div class="swiper-slide" style="display:flex; align-items:center; justify-content:center; background-color:#5C6BC0; color:white;">Slide 2</div>' +
                    '            <div class="swiper-slide" style="display:flex; align-items:center; justify-content:center; background-color:#42A5F5; color:white;">Slide 3</div>' +
                    '        </div>' +
                    '        <div class="swiper-button-next"></div>' +
                    '        <div class="swiper-button-prev"></div>' +
                    '        <div class="swiper-pagination"></div>' +
                    '    </div>' +
                    '</div>';
                bodyScripts +=
                    '<script>' +
                    "window.addEventListener('load', function() {" +
                    "    try {" +
                    "        new Swiper('.swiper', {" +
                    "            navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' }," +
                    "            pagination: { el: '.swiper-pagination' }," +
                    "            loop: true" +
                    "        });" +
                    "    } catch (e) { console.error('Swiper initialization failed inside iframe:', e); }" +
                    "});" +
                    '<\/script>';
            }

            const html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    ${styles}
                    ${headScripts}
                </head>
                <body>
                    ${bodyContent}
                    ${bodyScripts}
                </body>
                </html>
            `;

            return { html, totalSize, requestCount };
        };

        const resetSimulation = () => {
            controls.image.none.checked = true;
            controls.css.checked = false;
            controls.simpleJs.checked = false;
            controls.externalJs.checked = false;
            controls.heavyJs.checked = false;
            updateSimulation();
        };
        
        // すべてのコントロールにイベントリスナーを設定
        document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
            if(input.id !== 'base-html') {
                input.addEventListener('change', updateSimulation);
            }
        });

        resetButton.addEventListener('click', resetSimulation);

        window.addEventListener('load', updateSimulation);

    </script>
</body>
</html>
